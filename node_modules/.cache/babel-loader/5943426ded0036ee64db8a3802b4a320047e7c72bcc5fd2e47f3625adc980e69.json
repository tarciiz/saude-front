{"ast":null,"code":"import _slicedToArray from\"C:/Users/sidta/OneDrive/Documentos/Projects/sa\\xFAde/saude-front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useRef}from'react';import{Modal,Button}from'react-bootstrap';import Cropper from'react-cropper';import'cropperjs/dist/cropper.css';import{uploadFile,post}from\"../config/requisitions\";import{getUser,setUser}from\"../config/session\";import{toast}from'react-toastify';import{CircleLoader}from\"react-spinners\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ImageCropper=function ImageCropper(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showModal=_useState2[0],setShowModal=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),selectedImage=_useState4[0],setSelectedImage=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),format=_useState6[0],setFormat=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),croppedImage=_useState8[0],setCroppedImage=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),cropper=_useState10[0],setCropper=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loading=_useState12[0],setLoading=_useState12[1];var handleInitialized=function handleInitialized(instance){setCropper(instance);};var errorMessage=function errorMessage(m){toast.error(m,{position:toast.POSITION.TOP_CENTER,autoClose:2000,hideProgressBar:false,closeOnClick:true,pauseOnHover:true,draggable:true});};var successMessage=function successMessage(m){toast.success(m,{position:toast.POSITION.TOP_CENTER,autoClose:2000,hideProgressBar:false,closeOnClick:true,pauseOnHover:true,draggable:true});};var handleImageChange=function handleImageChange(e){setSelectedImage(URL.createObjectURL(e.target.files[0]));var selectedFile=e.target.files[0];var fileName=selectedFile.name;// Get the file extension (format)\nvar fileExtension=fileName.split('.').pop();setFormat(fileExtension);setShowModal(true);};var handleCloseModal=function handleCloseModal(){setShowModal(false);setSelectedImage(null);};var handleSave=function handleSave(){var canvas=cropper.getCroppedCanvas();var croppedImage=canvas.toDataURL(\"image/\"+format);console.log('croppedImage',croppedImage);var infoid=toast.info('Aguarde...',{autoClose:2000,hideProgressBar:true,closeOnClick:false,draggable:false,pauseOnHover:false});setLoading(true);handleCloseModal();fetch(croppedImage).then(function(res){return res.blob();}).then(function(blob){var file=new File([blob],\"file..jpg\");uploadFile('public/upload',file,getUser().id).then(function(filelink){console.log('FileLink ',filelink);if(filelink===undefined){throw'Erro';}var user=getUser();user.profilePicture=filelink;post('user/update',user).then(function(retUser){setUser(retUser);console.log('User ',getUser());window.location.reload(true);successMessage('Usuário atualizado com sucesso.');setLoading(false);}).catch(function(erro){console.log('Erro ',erro);errorMessage('Erro ao salvar foto de perfil, tente novamente.');setLoading(false);});}).catch(function(erro){console.log('Erro ',erro);setLoading(false);});});};return/*#__PURE__*/_jsxs(_Fragment,{children:[loading&&/*#__PURE__*/_jsxs(\"div\",{style:{position:\"absolute\",height:\"100vh\",width:\"100vw\",top:0,bottom:0,left:0,right:0,backgroundColor:\"rgba(255, 255, 255, 0.5)\"},children:[\"Aguarde, carregando...\",/*#__PURE__*/_jsx(CircleLoader,{})]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:handleImageChange}),/*#__PURE__*/_jsxs(Modal,{show:showModal,onHide:handleCloseModal,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Crop Image\"})}),/*#__PURE__*/_jsx(Modal.Body,{children:selectedImage&&/*#__PURE__*/_jsx(Cropper,{src:selectedImage,initialAspectRatio:1,guides:false,viewMode:2,aspectRatio:1/1,onInitialized:handleInitialized})}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleCloseModal,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleSave,children:\"Save\"})]})]})]});};export default ImageCropper;","map":{"version":3,"names":["React","useState","useRef","Modal","Button","Cropper","uploadFile","post","getUser","setUser","toast","CircleLoader","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ImageCropper","_useState","_useState2","_slicedToArray","showModal","setShowModal","_useState3","_useState4","selectedImage","setSelectedImage","_useState5","_useState6","format","setFormat","_useState7","_useState8","croppedImage","setCroppedImage","_useState9","_useState10","cropper","setCropper","_useState11","_useState12","loading","setLoading","handleInitialized","instance","errorMessage","m","error","position","POSITION","TOP_CENTER","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","successMessage","success","handleImageChange","e","URL","createObjectURL","target","files","selectedFile","fileName","name","fileExtension","split","pop","handleCloseModal","handleSave","canvas","getCroppedCanvas","toDataURL","console","log","infoid","info","fetch","then","res","blob","file","File","id","filelink","undefined","user","profilePicture","retUser","window","location","reload","catch","erro","children","style","height","width","top","bottom","left","right","backgroundColor","type","accept","onChange","show","onHide","Header","closeButton","Title","Body","src","initialAspectRatio","guides","viewMode","aspectRatio","onInitialized","Footer","variant","onClick"],"sources":["C:/Users/sidta/OneDrive/Documentos/Projects/saúde/saude-front/src/components/ImageCropper.js"],"sourcesContent":["import React, { useState, useRef } from 'react';\r\nimport { Modal, Button } from 'react-bootstrap';\r\nimport Cropper from 'react-cropper';\r\nimport 'cropperjs/dist/cropper.css';\r\nimport {uploadFile, post} from \"../config/requisitions\";\r\nimport {getUser, setUser} from \"../config/session\";\r\nimport { toast } from 'react-toastify';\r\nimport { CircleLoader } from \"react-spinners\";\r\n\r\nconst ImageCropper = () => {\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [selectedImage, setSelectedImage] = useState(null);\r\n  const [format, setFormat] = useState(null);\r\n  const [croppedImage, setCroppedImage] = useState('');\r\n  const [cropper, setCropper] = useState();\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleInitialized = (instance) => {\r\n    setCropper(instance);\r\n  };\r\n\r\n\r\n  const errorMessage = (m)=>{\r\n    toast.error(m, {\r\n      position: toast.POSITION.TOP_CENTER,\r\n      autoClose: 2000,\r\n      hideProgressBar: false,\r\n      closeOnClick: true,\r\n      pauseOnHover: true,\r\n      draggable: true,\r\n    });\r\n  }\r\n  const successMessage = (m)=>{\r\n    toast.success(m, {\r\n      position: toast.POSITION.TOP_CENTER,\r\n      autoClose: 2000,\r\n      hideProgressBar: false,\r\n      closeOnClick: true,\r\n      pauseOnHover: true,\r\n      draggable: true,\r\n    });\r\n  }\r\n\r\n  const handleImageChange = (e) => {\r\n    setSelectedImage(URL.createObjectURL(e.target.files[0]));\r\n    let selectedFile = e.target.files[0]\r\n    const fileName = selectedFile.name;\r\n\r\n    // Get the file extension (format)\r\n    const fileExtension = fileName.split('.').pop();\r\n    setFormat(fileExtension)\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleCloseModal = () => {\r\n    setShowModal(false);\r\n    setSelectedImage(null);\r\n  };\r\n\r\n\r\n  const handleSave = () => {\r\n    const canvas = cropper.getCroppedCanvas();\r\n    const croppedImage = canvas.toDataURL(\"image/\"+format);\r\n    console.log('croppedImage', croppedImage);\r\n      \r\n\r\n    var infoid = toast.info('Aguarde...', {\r\n      autoClose: 2000,\r\n      hideProgressBar: true,\r\n      closeOnClick: false,\r\n      draggable: false,\r\n      pauseOnHover: false,\r\n    });\r\n    setLoading(true);\r\n\r\n    \r\n    handleCloseModal();\r\n    fetch(croppedImage).then(res=>res.blob()).then(blob=>{\r\n      const file = new File([blob], \"file..jpg\")\r\n        uploadFile('public/upload', file, getUser().id).then(filelink=>{\r\n          console.log('FileLink ', filelink)\r\n          if(filelink === undefined) {\r\n            throw 'Erro';\r\n          }\r\n          let user = getUser()\r\n          user.profilePicture = filelink\r\n        \r\n        \r\n          post('user/update', user).then(retUser=>{\r\n              setUser(retUser)\r\n              console.log('User ', getUser())\r\n              window.location.reload(true)\r\n              successMessage('Usuário atualizado com sucesso.')\r\n              setLoading(false);\r\n\r\n          }).catch(erro=>{\r\n              console.log('Erro ', erro)\r\n              errorMessage('Erro ao salvar foto de perfil, tente novamente.')\r\n              setLoading(false);\r\n\r\n          })\r\n      \r\n      }).catch(erro=>{\r\n          console.log('Erro ', erro)\r\n          setLoading(false);\r\n\r\n      })\r\n    }) \r\n    \r\n    \r\n  \r\n  };\r\n\r\n  return (\r\n    <>\r\n      {loading && \r\n          <div\r\n          style={{\r\n            position: \"absolute\",\r\n            height: \"100vh\", \r\n            width: \"100vw\",\r\n            top: 0,\r\n            bottom: 0,\r\n            left: 0,\r\n            right: 0,\r\n            backgroundColor: \"rgba(255, 255, 255, 0.5)\"\r\n          }}\r\n        >\r\n          Aguarde, carregando...\r\n          <CircleLoader />\r\n        </div>\r\n      \r\n      }\r\n      <input type=\"file\" accept=\"image/*\" onChange={handleImageChange} />\r\n\r\n      <Modal show={showModal} onHide={handleCloseModal}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Crop Image</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          {selectedImage && (\r\n            <Cropper\r\n              src={selectedImage}\r\n              initialAspectRatio={1}\r\n              guides={false}\r\n              viewMode={2}\r\n              aspectRatio={1 / 1}\r\n              onInitialized={handleInitialized}\r\n            />\r\n          )}\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n          <Button variant=\"secondary\" onClick={handleCloseModal}>\r\n            Cancel\r\n          </Button>\r\n          <Button variant=\"primary\" onClick={handleSave}>\r\n            Save\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ImageCropper;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}